function ae(c,y){for(var p=0;p<y.length;p++){const f=y[p];if(typeof f!="string"&&!Array.isArray(f)){for(const n in f)if(n!=="default"&&!(n in c)){const e=Object.getOwnPropertyDescriptor(f,n);e&&Object.defineProperty(c,n,e.get?e:{enumerable:!0,get:()=>f[n]})}}}return Object.freeze(Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}))}function oe(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}function se(c){if(Object.prototype.hasOwnProperty.call(c,"__esModule"))return c;var y=c.default;if(typeof y=="function"){var p=function f(){return this instanceof f?Reflect.construct(y,arguments,this.constructor):y.apply(this,arguments)};p.prototype=y.prototype}else p={};return Object.defineProperty(p,"__esModule",{value:!0}),Object.keys(c).forEach(function(f){var n=Object.getOwnPropertyDescriptor(c,f);Object.defineProperty(p,f,n.get?n:{enumerable:!0,get:function(){return c[f]}})}),p}var w={},B={},_,A;function ue(){if(A)return _;A=1;function c(n){var e=new f(n),r=e.readChunk();if(r.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+r.id+"'";for(var o=y(r.data),u=[],i=0;!e.eof()&&i<o.numTracks;i++){var t=e.readChunk();if(t.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+t.id+"'";var a=p(t.data);u.push(a)}return{header:o,tracks:u}}function y(n){var e=new f(n),r=e.readUInt16(),o=e.readUInt16(),u={format:r,numTracks:o},i=e.readUInt16();return i&32768?(u.framesPerSecond=256-(i>>8),u.ticksPerFrame=i&255):u.ticksPerBeat=i,u}function p(n){for(var e=new f(n),r=[];!e.eof();){var o=i();r.push(o)}return r;var u;function i(){var t={};t.deltaTime=e.readVarInt();var a=e.readUInt8();if((a&240)===240)if(a===255){t.meta=!0;var d=e.readUInt8(),s=e.readVarInt();switch(d){case 0:if(t.type="sequenceNumber",s!==2)throw"Expected length for sequenceNumber event is 2, got "+s;return t.number=e.readUInt16(),t;case 1:return t.type="text",t.text=e.readString(s),t;case 2:return t.type="copyrightNotice",t.text=e.readString(s),t;case 3:return t.type="trackName",t.text=e.readString(s),t;case 4:return t.type="instrumentName",t.text=e.readString(s),t;case 5:return t.type="lyrics",t.text=e.readString(s),t;case 6:return t.type="marker",t.text=e.readString(s),t;case 7:return t.type="cuePoint",t.text=e.readString(s),t;case 32:if(t.type="channelPrefix",s!=1)throw"Expected length for channelPrefix event is 1, got "+s;return t.channel=e.readUInt8(),t;case 33:if(t.type="portPrefix",s!=1)throw"Expected length for portPrefix event is 1, got "+s;return t.port=e.readUInt8(),t;case 47:if(t.type="endOfTrack",s!=0)throw"Expected length for endOfTrack event is 0, got "+s;return t;case 81:if(t.type="setTempo",s!=3)throw"Expected length for setTempo event is 3, got "+s;return t.microsecondsPerBeat=e.readUInt24(),t;case 84:if(t.type="smpteOffset",s!=5)throw"Expected length for smpteOffset event is 5, got "+s;var v=e.readUInt8(),k={0:24,32:25,64:29,96:30};return t.frameRate=k[v&96],t.hour=v&31,t.min=e.readUInt8(),t.sec=e.readUInt8(),t.frame=e.readUInt8(),t.subFrame=e.readUInt8(),t;case 88:if(t.type="timeSignature",s!=2&&s!=4)throw"Expected length for timeSignature event is 4 or 2, got "+s;return t.numerator=e.readUInt8(),t.denominator=1<<e.readUInt8(),s===4?(t.metronome=e.readUInt8(),t.thirtyseconds=e.readUInt8()):(t.metronome=36,t.thirtyseconds=8),t;case 89:if(t.type="keySignature",s!=2)throw"Expected length for keySignature event is 2, got "+s;return t.key=e.readInt8(),t.scale=e.readUInt8(),t;case 127:return t.type="sequencerSpecific",t.data=e.readBytes(s),t;default:return t.type="unknownMeta",t.data=e.readBytes(s),t.metatypeByte=d,t}}else if(a==240){t.type="sysEx";var s=e.readVarInt();return t.data=e.readBytes(s),t}else if(a==247){t.type="endSysEx";var s=e.readVarInt();return t.data=e.readBytes(s),t}else throw"Unrecognised MIDI event type byte: "+a;else{var m;if((a&128)===0){if(u===null)throw"Running status byte encountered before status byte";m=a,a=u,t.running=!0}else m=e.readUInt8(),u=a;var l=a>>4;switch(t.channel=a&15,l){case 8:return t.type="noteOff",t.noteNumber=m,t.velocity=e.readUInt8(),t;case 9:var b=e.readUInt8();return t.type=b===0?"noteOff":"noteOn",t.noteNumber=m,t.velocity=b,b===0&&(t.byte9=!0),t;case 10:return t.type="noteAftertouch",t.noteNumber=m,t.amount=e.readUInt8(),t;case 11:return t.type="controller",t.controllerType=m,t.value=e.readUInt8(),t;case 12:return t.type="programChange",t.programNumber=m,t;case 13:return t.type="channelAftertouch",t.amount=m,t;case 14:return t.type="pitchBend",t.value=m+(e.readUInt8()<<7)-8192,t;default:throw"Unrecognised MIDI event type: "+l}}}}function f(n){this.buffer=n,this.bufferLen=this.buffer.length,this.pos=0}return f.prototype.eof=function(){return this.pos>=this.bufferLen},f.prototype.readUInt8=function(){var n=this.buffer[this.pos];return this.pos+=1,n},f.prototype.readInt8=function(){var n=this.readUInt8();return n&128?n-256:n},f.prototype.readUInt16=function(){var n=this.readUInt8(),e=this.readUInt8();return(n<<8)+e},f.prototype.readInt16=function(){var n=this.readUInt16();return n&32768?n-65536:n},f.prototype.readUInt24=function(){var n=this.readUInt8(),e=this.readUInt8(),r=this.readUInt8();return(n<<16)+(e<<8)+r},f.prototype.readInt24=function(){var n=this.readUInt24();return n&8388608?n-16777216:n},f.prototype.readUInt32=function(){var n=this.readUInt8(),e=this.readUInt8(),r=this.readUInt8(),o=this.readUInt8();return(n<<24)+(e<<16)+(r<<8)+o},f.prototype.readBytes=function(n){var e=this.buffer.slice(this.pos,this.pos+n);return this.pos+=n,e},f.prototype.readString=function(n){var e=this.readBytes(n);return String.fromCharCode.apply(null,e)},f.prototype.readVarInt=function(){for(var n=0;!this.eof();){var e=this.readUInt8();if(e&128)n+=e&127,n<<=7;else return n+e}return n},f.prototype.readChunk=function(){var n=this.readString(4),e=this.readUInt32(),r=this.readBytes(e);return{id:n,length:e,data:r}},_=c,_}var q,D;function ce(){if(D)return q;D=1;function c(e,r){if(typeof e!="object")throw"Invalid MIDI data";r=r||{};var o=e.header||{},u=e.tracks||[],i,t=u.length,a=new n;for(y(a,o,t),i=0;i<t;i++)p(a,u[i],r);return a.buffer}function y(e,r,o){var u=r.format==null?1:r.format,i=128;r.timeDivision?i=r.timeDivision:r.ticksPerFrame&&r.framesPerSecond?i=-(r.framesPerSecond&255)<<8|r.ticksPerFrame&255:r.ticksPerBeat&&(i=r.ticksPerBeat&32767);var t=new n;t.writeUInt16(u),t.writeUInt16(o),t.writeUInt16(i),e.writeChunk("MThd",t.buffer)}function p(e,r,o){var u=new n,i,t=r.length,a=null;for(i=0;i<t;i++)(o.running===!1||!o.running&&!r[i].running)&&(a=null),a=f(u,r[i],a,o.useByte9ForNoteOff);e.writeChunk("MTrk",u.buffer)}function f(e,r,o,u){var i=r.type,t=r.deltaTime,a=r.text||"",d=r.data||[],s=null;switch(e.writeVarInt(t),i){case"sequenceNumber":e.writeUInt8(255),e.writeUInt8(0),e.writeVarInt(2),e.writeUInt16(r.number);break;case"text":e.writeUInt8(255),e.writeUInt8(1),e.writeVarInt(a.length),e.writeString(a);break;case"copyrightNotice":e.writeUInt8(255),e.writeUInt8(2),e.writeVarInt(a.length),e.writeString(a);break;case"trackName":e.writeUInt8(255),e.writeUInt8(3),e.writeVarInt(a.length),e.writeString(a);break;case"instrumentName":e.writeUInt8(255),e.writeUInt8(4),e.writeVarInt(a.length),e.writeString(a);break;case"lyrics":e.writeUInt8(255),e.writeUInt8(5),e.writeVarInt(a.length),e.writeString(a);break;case"marker":e.writeUInt8(255),e.writeUInt8(6),e.writeVarInt(a.length),e.writeString(a);break;case"cuePoint":e.writeUInt8(255),e.writeUInt8(7),e.writeVarInt(a.length),e.writeString(a);break;case"channelPrefix":e.writeUInt8(255),e.writeUInt8(32),e.writeVarInt(1),e.writeUInt8(r.channel);break;case"portPrefix":e.writeUInt8(255),e.writeUInt8(33),e.writeVarInt(1),e.writeUInt8(r.port);break;case"endOfTrack":e.writeUInt8(255),e.writeUInt8(47),e.writeVarInt(0);break;case"setTempo":e.writeUInt8(255),e.writeUInt8(81),e.writeVarInt(3),e.writeUInt24(r.microsecondsPerBeat);break;case"smpteOffset":e.writeUInt8(255),e.writeUInt8(84),e.writeVarInt(5);var v={24:0,25:32,29:64,30:96},k=r.hour&31|v[r.frameRate];e.writeUInt8(k),e.writeUInt8(r.min),e.writeUInt8(r.sec),e.writeUInt8(r.frame),e.writeUInt8(r.subFrame);break;case"timeSignature":e.writeUInt8(255),e.writeUInt8(88),e.writeVarInt(4),e.writeUInt8(r.numerator);var m=Math.floor(Math.log(r.denominator)/Math.LN2)&255;e.writeUInt8(m),e.writeUInt8(r.metronome),e.writeUInt8(r.thirtyseconds||8);break;case"keySignature":e.writeUInt8(255),e.writeUInt8(89),e.writeVarInt(2),e.writeInt8(r.key),e.writeUInt8(r.scale);break;case"sequencerSpecific":e.writeUInt8(255),e.writeUInt8(127),e.writeVarInt(d.length),e.writeBytes(d);break;case"unknownMeta":r.metatypeByte!=null&&(e.writeUInt8(255),e.writeUInt8(r.metatypeByte),e.writeVarInt(d.length),e.writeBytes(d));break;case"sysEx":e.writeUInt8(240),e.writeVarInt(d.length),e.writeBytes(d);break;case"endSysEx":e.writeUInt8(247),e.writeVarInt(d.length),e.writeBytes(d);break;case"noteOff":var l=u!==!1&&r.byte9||u&&r.velocity==0?144:128;s=l|r.channel,s!==o&&e.writeUInt8(s),e.writeUInt8(r.noteNumber),e.writeUInt8(r.velocity);break;case"noteOn":s=144|r.channel,s!==o&&e.writeUInt8(s),e.writeUInt8(r.noteNumber),e.writeUInt8(r.velocity);break;case"noteAftertouch":s=160|r.channel,s!==o&&e.writeUInt8(s),e.writeUInt8(r.noteNumber),e.writeUInt8(r.amount);break;case"controller":s=176|r.channel,s!==o&&e.writeUInt8(s),e.writeUInt8(r.controllerType),e.writeUInt8(r.value);break;case"programChange":s=192|r.channel,s!==o&&e.writeUInt8(s),e.writeUInt8(r.programNumber);break;case"channelAftertouch":s=208|r.channel,s!==o&&e.writeUInt8(s),e.writeUInt8(r.amount);break;case"pitchBend":s=224|r.channel,s!==o&&e.writeUInt8(s);var b=8192+r.value,g=b&127,h=b>>7&127;e.writeUInt8(g),e.writeUInt8(h);break;default:throw"Unrecognized event type: "+i}return s}function n(){this.buffer=[]}return n.prototype.writeUInt8=function(e){this.buffer.push(e&255)},n.prototype.writeInt8=n.prototype.writeUInt8,n.prototype.writeUInt16=function(e){var r=e>>8&255,o=e&255;this.writeUInt8(r),this.writeUInt8(o)},n.prototype.writeInt16=n.prototype.writeUInt16,n.prototype.writeUInt24=function(e){var r=e>>16&255,o=e>>8&255,u=e&255;this.writeUInt8(r),this.writeUInt8(o),this.writeUInt8(u)},n.prototype.writeInt24=n.prototype.writeUInt24,n.prototype.writeUInt32=function(e){var r=e>>24&255,o=e>>16&255,u=e>>8&255,i=e&255;this.writeUInt8(r),this.writeUInt8(o),this.writeUInt8(u),this.writeUInt8(i)},n.prototype.writeInt32=n.prototype.writeUInt32,n.prototype.writeBytes=function(e){this.buffer=this.buffer.concat(Array.prototype.slice.call(e,0))},n.prototype.writeString=function(e){var r,o=e.length,u=[];for(r=0;r<o;r++)u.push(e.codePointAt(r));this.writeBytes(u)},n.prototype.writeVarInt=function(e){if(e<0)throw"Cannot write negative variable-length integer";if(e<=127)this.writeUInt8(e);else{var r=e,o=[];for(o.push(r&127),r>>=7;r;){var u=r&127|128;o.push(u),r>>=7}this.writeBytes(o.reverse())}},n.prototype.writeChunk=function(e,r){this.writeString(e),this.writeUInt32(r.length),this.writeBytes(r)},q=c,q}var H;function ee(){return H||(H=1,B.parseMidi=ue(),B.writeMidi=ce()),B}var j={},U={},J;function te(){if(J)return U;J=1,Object.defineProperty(U,"__esModule",{value:!0}),U.insert=U.search=void 0;function c(p,f,n){n===void 0&&(n="ticks");var e=0,r=p.length,o=r;if(r>0&&p[r-1][n]<=f)return r-1;for(;e<o;){var u=Math.floor(e+(o-e)/2),i=p[u],t=p[u+1];if(i[n]===f){for(var a=u;a<p.length;a++){var d=p[a];d[n]===f&&(u=a)}return u}else{if(i[n]<f&&t[n]>f)return u;i[n]>f?o=u:i[n]<f&&(e=u+1)}}return-1}U.search=c;function y(p,f,n){if(n===void 0&&(n="ticks"),p.length){var e=c(p,f[n],n);p.splice(e+1,0,f)}else p.push(f)}return U.insert=y,U}var R;function V(){return R||(R=1,(function(c){Object.defineProperty(c,"__esModule",{value:!0}),c.Header=c.keySignatureKeys=void 0;var y=te(),p=new WeakMap;c.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var f=(function(){function n(e){var r=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",p.set(this,480),e){p.set(this,e.header.ticksPerBeat),e.tracks.forEach(function(u){u.forEach(function(i){i.meta&&(i.type==="timeSignature"?r.timeSignatures.push({ticks:i.absoluteTime,timeSignature:[i.numerator,i.denominator]}):i.type==="setTempo"?r.tempos.push({bpm:6e7/i.microsecondsPerBeat,ticks:i.absoluteTime}):i.type==="keySignature"&&r.keySignatures.push({key:c.keySignatureKeys[i.key+7],scale:i.scale===0?"major":"minor",ticks:i.absoluteTime}))})});var o=0;e.tracks[0].forEach(function(u){o+=u.deltaTime,u.meta&&(u.type==="trackName"?r.name=u.text:(u.type==="text"||u.type==="cuePoint"||u.type==="marker"||u.type==="lyrics")&&r.meta.push({text:u.text,ticks:o,type:u.type}))}),this.update()}}return n.prototype.update=function(){var e=this,r=0,o=0;this.tempos.sort(function(u,i){return u.ticks-i.ticks}),this.tempos.forEach(function(u,i){var t=i>0?e.tempos[i-1].bpm:e.tempos[0].bpm,a=u.ticks/e.ppq-o,d=60/t*a;u.time=d+r,r=u.time,o+=a}),this.timeSignatures.sort(function(u,i){return u.ticks-i.ticks}),this.timeSignatures.forEach(function(u,i){var t=i>0?e.timeSignatures[i-1]:e.timeSignatures[0],a=(u.ticks-t.ticks)/e.ppq,d=a/t.timeSignature[0]/(t.timeSignature[1]/4);t.measures=t.measures||0,u.measures=d+t.measures})},n.prototype.ticksToSeconds=function(e){var r=(0,y.search)(this.tempos,e);if(r!==-1){var o=this.tempos[r],u=o.time,i=(e-o.ticks)/this.ppq;return u+60/o.bpm*i}else{var t=e/this.ppq;return 60/120*t}},n.prototype.ticksToMeasures=function(e){var r=(0,y.search)(this.timeSignatures,e);if(r!==-1){var o=this.timeSignatures[r],u=(e-o.ticks)/this.ppq;return o.measures+u/(o.timeSignature[0]/o.timeSignature[1])/4}else return e/this.ppq/4},Object.defineProperty(n.prototype,"ppq",{get:function(){return p.get(this)},enumerable:!1,configurable:!0}),n.prototype.secondsToTicks=function(e){var r=(0,y.search)(this.tempos,e,"time");if(r!==-1){var o=this.tempos[r],u=o.time,i=e-u,t=i/(60/o.bpm);return Math.round(o.ticks+t*this.ppq)}else{var a=e/.5;return Math.round(a*this.ppq)}},n.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(e){return{bpm:e.bpm,ticks:e.ticks}}),timeSignatures:this.timeSignatures}},n.prototype.fromJSON=function(e){this.name=e.name,this.tempos=e.tempos.map(function(r){return Object.assign({},r)}),this.timeSignatures=e.timeSignatures.map(function(r){return Object.assign({},r)}),this.keySignatures=e.keySignatures.map(function(r){return Object.assign({},r)}),this.meta=e.meta.map(function(r){return Object.assign({},r)}),p.set(this,e.ppq),this.update()},n.prototype.setTempo=function(e){this.tempos=[{bpm:e,ticks:0}],this.update()},n})();c.Header=f})(j)),j}var C={},E={},W;function re(){return W||(W=1,(function(c){Object.defineProperty(c,"__esModule",{value:!0}),c.ControlChange=c.controlChangeIds=c.controlChangeNames=void 0,c.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},c.controlChangeIds=Object.keys(c.controlChangeNames).reduce(function(n,e){return n[c.controlChangeNames[e]]=e,n},{});var y=new WeakMap,p=new WeakMap,f=(function(){function n(e,r){y.set(this,r),p.set(this,e.controllerType),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(n.prototype,"number",{get:function(){return p.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return c.controlChangeNames[this.number]?c.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"time",{get:function(){var e=y.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var r=y.get(this);this.ticks=r.secondsToTicks(e)},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},n})();c.ControlChange=f})(E)),E}var F={},z;function fe(){if(z)return F;z=1,Object.defineProperty(F,"__esModule",{value:!0}),F.createControlChanges=void 0;var c=re();function y(){return new Proxy({},{get:function(p,f){if(p[f])return p[f];if(c.controlChangeIds.hasOwnProperty(f))return p[c.controlChangeIds[f]]},set:function(p,f,n){return c.controlChangeIds.hasOwnProperty(f)?p[c.controlChangeIds[f]]=n:p[f]=n,!0}})}return F.createControlChanges=y,F}var M={},G;function he(){if(G)return M;G=1,Object.defineProperty(M,"__esModule",{value:!0}),M.PitchBend=void 0;var c=new WeakMap,y=(function(){function p(f,n){c.set(this,n),this.ticks=f.absoluteTime,this.value=f.value}return Object.defineProperty(p.prototype,"time",{get:function(){var f=c.get(this);return f.ticksToSeconds(this.ticks)},set:function(f){var n=c.get(this);this.ticks=n.secondsToTicks(f)},enumerable:!1,configurable:!0}),p.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},p})();return M.PitchBend=y,M}var P={},T={},K;function le(){return K||(K=1,Object.defineProperty(T,"__esModule",{value:!0}),T.DrumKitByPatchID=T.InstrumentFamilyByID=T.instrumentByPatchID=void 0,T.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],T.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],T.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}),T}var L;function de(){if(L)return P;L=1,Object.defineProperty(P,"__esModule",{value:!0}),P.Instrument=void 0;var c=le(),y=new WeakMap,p=(function(){function f(n,e){if(this.number=0,y.set(this,e),this.number=0,n){var r=n.find(function(o){return o.type==="programChange"});r&&(this.number=r.programNumber)}}return Object.defineProperty(f.prototype,"name",{get:function(){return this.percussion?c.DrumKitByPatchID[this.number]:c.instrumentByPatchID[this.number]},set:function(n){var e=c.instrumentByPatchID.indexOf(n);e!==-1&&(this.number=e)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"family",{get:function(){return this.percussion?"drums":c.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"percussion",{get:function(){var n=y.get(this);return n.channel===9},enumerable:!1,configurable:!0}),f.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},f.prototype.fromJSON=function(n){this.number=n.number},f})();return P.Instrument=p,P}var N={},Q;function pe(){if(Q)return N;Q=1,Object.defineProperty(N,"__esModule",{value:!0}),N.Note=void 0;function c(r){var o=Math.floor(r/12)-1;return y(r)+o.toString()}function y(r){var o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],u=r%12;return o[u]}function p(r){var o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return o.indexOf(r)}var f=(function(){var r=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,o={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(u){var i=r.exec(u),t=i[1],a=i[2],d=o[t.toLowerCase()];return d+(parseInt(a,10)+1)*12}})(),n=new WeakMap,e=(function(){function r(o,u,i){n.set(this,i),this.midi=o.midi,this.velocity=o.velocity,this.noteOffVelocity=u.velocity,this.ticks=o.ticks,this.durationTicks=u.ticks-o.ticks}return Object.defineProperty(r.prototype,"name",{get:function(){return c(this.midi)},set:function(o){this.midi=f(o)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(o){var u=o-this.octave;this.midi+=u*12},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"pitch",{get:function(){return y(this.midi)},set:function(o){this.midi=12*(this.octave+1)+p(o)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"duration",{get:function(){var o=n.get(this);return o.ticksToSeconds(this.ticks+this.durationTicks)-o.ticksToSeconds(this.ticks)},set:function(o){var u=n.get(this),i=u.secondsToTicks(this.time+o);this.durationTicks=i-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"time",{get:function(){var o=n.get(this);return o.ticksToSeconds(this.ticks)},set:function(o){var u=n.get(this);this.ticks=u.secondsToTicks(o)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"bars",{get:function(){var o=n.get(this);return o.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),r.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},r})();return N.Note=e,N}var X;function Y(){if(X)return C;X=1,Object.defineProperty(C,"__esModule",{value:!0}),C.Track=void 0;var c=te(),y=re(),p=fe(),f=he(),n=de(),e=pe(),r=new WeakMap,o=(function(){function u(i,t){var a=this;if(this.name="",this.notes=[],this.controlChanges=(0,p.createControlChanges)(),this.pitchBends=[],r.set(this,t),i){var d=i.find(function(h){return h.type==="trackName"});this.name=d?d.text:""}if(this.instrument=new n.Instrument(i,this),this.channel=0,i){for(var s=i.filter(function(h){return h.type==="noteOn"}),v=i.filter(function(h){return h.type==="noteOff"}),k=function(){var h=s.shift();m.channel=h.channel;var I=v.findIndex(function(S){return S.noteNumber===h.noteNumber&&S.absoluteTime>=h.absoluteTime});if(I!==-1){var x=v.splice(I,1)[0];m.addNote({durationTicks:x.absoluteTime-h.absoluteTime,midi:h.noteNumber,noteOffVelocity:x.velocity/127,ticks:h.absoluteTime,velocity:h.velocity/127})}},m=this;s.length;)k();var l=i.filter(function(h){return h.type==="controller"});l.forEach(function(h){a.addCC({number:h.controllerType,ticks:h.absoluteTime,value:h.value/127})});var b=i.filter(function(h){return h.type==="pitchBend"});b.forEach(function(h){a.addPitchBend({ticks:h.absoluteTime,value:h.value/Math.pow(2,13)})});var g=i.find(function(h){return h.type==="endOfTrack"});this.endOfTrackTicks=g!==void 0?g.absoluteTime:void 0}}return u.prototype.addNote=function(i){var t=r.get(this),a=new e.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},t);return Object.assign(a,i),(0,c.insert)(this.notes,a,"ticks"),this},u.prototype.addCC=function(i){var t=r.get(this),a=new y.ControlChange({controllerType:i.number},t);return delete i.number,Object.assign(a,i),Array.isArray(this.controlChanges[a.number])||(this.controlChanges[a.number]=[]),(0,c.insert)(this.controlChanges[a.number],a,"ticks"),this},u.prototype.addPitchBend=function(i){var t=r.get(this),a=new f.PitchBend({},t);return Object.assign(a,i),(0,c.insert)(this.pitchBends,a,"ticks"),this},Object.defineProperty(u.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var i=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,t=0;t<this.notes.length-1;t++){var a=this.notes[t].time+this.notes[t].duration;i<a&&(i=a)}return i},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var i=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,t=0;t<this.notes.length-1;t++){var a=this.notes[t].ticks+this.notes[t].durationTicks;i<a&&(i=a)}return i},enumerable:!1,configurable:!0}),u.prototype.fromJSON=function(i){var t=this;this.name=i.name,this.channel=i.channel,this.instrument=new n.Instrument(void 0,this),this.instrument.fromJSON(i.instrument),i.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=i.endOfTrackTicks);for(var a in i.controlChanges)i.controlChanges[a]&&i.controlChanges[a].forEach(function(d){t.addCC({number:d.number,ticks:d.ticks,value:d.value})});i.notes.forEach(function(d){t.addNote({durationTicks:d.durationTicks,midi:d.midi,ticks:d.ticks,velocity:d.velocity})})},u.prototype.toJSON=function(){for(var i={},t=0;t<127;t++)this.controlChanges.hasOwnProperty(t)&&(i[t]=this.controlChanges[t].map(function(d){return d.toJSON()}));var a={channel:this.channel,controlChanges:i,pitchBends:this.pitchBends.map(function(d){return d.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(d){return d.toJSON()})};return this.endOfTrackTicks!==void 0&&(a.endOfTrackTicks=this.endOfTrackTicks),a},u})();return C.Track=o,C}var O={};function me(c){var y=[];return ne(c,y),y}function ne(c,y){for(var p=0;p<c.length;p++){var f=c[p];Array.isArray(f)?ne(f,y):y.push(f)}}const be=Object.freeze(Object.defineProperty({__proto__:null,flatten:me},Symbol.toStringTag,{value:"Module"})),ye=se(be);var Z;function ge(){if(Z)return O;Z=1;var c=O&&O.__spreadArray||function(l,b,g){if(g||arguments.length===2)for(var h=0,I=b.length,x;h<I;h++)(x||!(h in b))&&(x||(x=Array.prototype.slice.call(b,0,h)),x[h]=b[h]);return l.concat(x||Array.prototype.slice.call(b))};Object.defineProperty(O,"__esModule",{value:!0}),O.encode=void 0;var y=ee(),p=V(),f=ye;function n(l,b){return[{absoluteTime:l.ticks,channel:b,deltaTime:0,noteNumber:l.midi,type:"noteOn",velocity:Math.floor(l.velocity*127)},{absoluteTime:l.ticks+l.durationTicks,channel:b,deltaTime:0,noteNumber:l.midi,type:"noteOff",velocity:Math.floor(l.noteOffVelocity*127)}]}function e(l){return(0,f.flatten)(l.notes.map(function(b){return n(b,l.channel)}))}function r(l,b){return{absoluteTime:l.ticks,channel:b,controllerType:l.number,deltaTime:0,type:"controller",value:Math.floor(l.value*127)}}function o(l){for(var b=[],g=0;g<127;g++)l.controlChanges.hasOwnProperty(g)&&l.controlChanges[g].forEach(function(h){b.push(r(h,l.channel))});return b}function u(l,b){return{absoluteTime:l.ticks,channel:b,deltaTime:0,type:"pitchBend",value:l.value}}function i(l){var b=[];return l.pitchBends.forEach(function(g){b.push(u(g,l.channel))}),b}function t(l){return{absoluteTime:0,channel:l.channel,deltaTime:0,programNumber:l.instrument.number,type:"programChange"}}function a(l){return{absoluteTime:0,deltaTime:0,meta:!0,text:l,type:"trackName"}}function d(l){return{absoluteTime:l.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/l.bpm),type:"setTempo"}}function s(l){return{absoluteTime:l.ticks,deltaTime:0,denominator:l.timeSignature[1],meta:!0,metronome:24,numerator:l.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function v(l){var b=p.keySignatureKeys.indexOf(l.key);return{absoluteTime:l.ticks,deltaTime:0,key:b+7,meta:!0,scale:l.scale==="major"?0:1,type:"keySignature"}}function k(l){return{absoluteTime:l.ticks,deltaTime:0,meta:!0,text:l.text,type:l.type}}function m(l){var b={header:{format:1,numTracks:l.tracks.length+1,ticksPerBeat:l.header.ppq},tracks:c([c(c(c(c([{absoluteTime:0,deltaTime:0,meta:!0,text:l.header.name,type:"trackName"}],l.header.keySignatures.map(function(g){return v(g)}),!0),l.header.meta.map(function(g){return k(g)}),!0),l.header.tempos.map(function(g){return d(g)}),!0),l.header.timeSignatures.map(function(g){return s(g)}),!0)],l.tracks.map(function(g){return c(c(c([a(g.name),t(g)],e(g),!0),o(g),!0),i(g),!0)}),!0)};return b.tracks=b.tracks.map(function(g){g=g.sort(function(I,x){return I.absoluteTime-x.absoluteTime});var h=0;return g.forEach(function(I){I.deltaTime=I.absoluteTime-h,h=I.absoluteTime,delete I.absoluteTime}),g.push({deltaTime:0,meta:!0,type:"endOfTrack"}),g}),new Uint8Array((0,y.writeMidi)(b))}return O.encode=m,O}var $;function ve(){return $||($=1,(function(c){var y=w&&w.__awaiter||function(a,d,s,v){function k(m){return m instanceof s?m:new s(function(l){l(m)})}return new(s||(s=Promise))(function(m,l){function b(I){try{h(v.next(I))}catch(x){l(x)}}function g(I){try{h(v.throw(I))}catch(x){l(x)}}function h(I){I.done?m(I.value):k(I.value).then(b,g)}h((v=v.apply(a,d||[])).next())})},p=w&&w.__generator||function(a,d){var s={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},v,k,m,l;return l={next:b(0),throw:b(1),return:b(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function b(h){return function(I){return g([h,I])}}function g(h){if(v)throw new TypeError("Generator is already executing.");for(;s;)try{if(v=1,k&&(m=h[0]&2?k.return:h[0]?k.throw||((m=k.return)&&m.call(k),0):k.next)&&!(m=m.call(k,h[1])).done)return m;switch(k=0,m&&(h=[h[0]&2,m.value]),h[0]){case 0:case 1:m=h;break;case 4:return s.label++,{value:h[1],done:!1};case 5:s.label++,k=h[1],h=[0];continue;case 7:h=s.ops.pop(),s.trys.pop();continue;default:if(m=s.trys,!(m=m.length>0&&m[m.length-1])&&(h[0]===6||h[0]===2)){s=0;continue}if(h[0]===3&&(!m||h[1]>m[0]&&h[1]<m[3])){s.label=h[1];break}if(h[0]===6&&s.label<m[1]){s.label=m[1],m=h;break}if(m&&s.label<m[2]){s.label=m[2],s.ops.push(h);break}m[2]&&s.ops.pop(),s.trys.pop();continue}h=d.call(a,s)}catch(I){h=[6,I],k=0}finally{v=m=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}};Object.defineProperty(c,"__esModule",{value:!0}),c.Header=c.Track=c.Midi=void 0;var f=ee(),n=V(),e=Y(),r=ge(),o=(function(){function a(d){var s=this,v=null;if(d){var k=d instanceof ArrayBuffer?new Uint8Array(d):d;v=(0,f.parseMidi)(k),v.tracks.forEach(function(m){var l=0;m.forEach(function(b){l+=b.deltaTime,b.absoluteTime=l})}),v.tracks=t(v.tracks)}this.header=new n.Header(v),this.tracks=[],d&&(this.tracks=v.tracks.map(function(m){return new e.Track(m,s.header)}),v.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return a.fromUrl=function(d){return y(this,void 0,void 0,function(){var s,v;return p(this,function(k){switch(k.label){case 0:return[4,fetch(d)];case 1:return s=k.sent(),s.ok?[4,s.arrayBuffer()]:[3,3];case 2:return v=k.sent(),[2,new a(v)];case 3:throw new Error("Could not load '".concat(d,"'"))}})})},Object.defineProperty(a.prototype,"name",{get:function(){return this.header.name},set:function(d){this.header.name=d},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"duration",{get:function(){var d=this.tracks.map(function(s){return s.duration});return Math.max.apply(Math,d)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"durationTicks",{get:function(){var d=this.tracks.map(function(s){return s.durationTicks});return Math.max.apply(Math,d)},enumerable:!1,configurable:!0}),a.prototype.addTrack=function(){var d=new e.Track(void 0,this.header);return this.tracks.push(d),d},a.prototype.toArray=function(){return(0,r.encode)(this)},a.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(d){return d.toJSON()})}},a.prototype.fromJSON=function(d){var s=this;this.header=new n.Header,this.header.fromJSON(d.header),this.tracks=d.tracks.map(function(v){var k=new e.Track(void 0,s.header);return k.fromJSON(v),k})},a.prototype.clone=function(){var d=new a;return d.fromJSON(this.toJSON()),d},a})();c.Midi=o;var u=Y();Object.defineProperty(c,"Track",{enumerable:!0,get:function(){return u.Track}});var i=V();Object.defineProperty(c,"Header",{enumerable:!0,get:function(){return i.Header}});function t(a){for(var d=[],s=0;s<a.length;s++)for(var v=d.length,k=new Map,m=Array(16).fill(0),l=0,b=a[s];l<b.length;l++){var g=b[l],h=v,I=g.channel;if(I!==void 0){g.type==="programChange"&&(m[I]=g.programNumber);var x=m[I],S="".concat(x," ").concat(I);k.has(S)?h=k.get(S):(h=v+k.size,k.set(S,h))}d[h]||d.push([]),d[h].push(g)}return d}})(w)),w}var ie=ve();const ke=oe(ie),Ie=ae({__proto__:null,default:ke},[ie]);export{Ie as M};
